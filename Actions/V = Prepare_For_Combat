-- Define the NPC object
NPC = {
    name = "Warrior",  -- NPC's name
    position = {x = 5, y = 5},  -- Current position
    health = 100,  -- NPC's current health
    weapon_ready = false,  -- Indicates whether the NPC's weapon is ready
    shield_up = false,  -- Indicates whether the NPC has raised their shield
    awareness = 5,  -- Awareness level, used for scanning the environment
}

-- Define potential enemies in the environment
enemies_in_area = {
    {name = "Goblin", position = {x = 7, y = 6}, threat_level = 3},
    {name = "Orc", position = {x = 10, y = 12}, threat_level = 5},
}

-- Function to calculate the distance between two points
function calculate_distance(point1, point2)
    local dx = point2.x - point1.x
    local dy = point2.y - point1.y
    return math.sqrt(dx * dx + dy * dy)
end

-- Function to scan the environment for nearby enemies
function scan_for_enemies()
    local detected_enemies = {}

    for _, enemy in ipairs(enemies_in_area) do
        local distance_to_enemy = calculate_distance(NPC.position, enemy.position)
        if distance_to_enemy <= NPC.awareness then
            table.insert(detected_enemies, enemy)
            print(NPC.name .. " detects " .. enemy.name .. " within combat range.")
        end
    end

    return detected_enemies
end

-- Prepare for Combat action function
function prepare_for_combat_action()
    -- Step 1: Ready the weapon
    NPC.weapon_ready = true
    print(NPC.name .. " draws their weapon, ready for combat.")

    -- Step 2: Raise shield or enter a defensive stance
    NPC.shield_up = true
    print(NPC.name .. " raises their shield, taking a defensive stance.")

    -- Step 3: Scan the environment for nearby enemies
    local enemies_detected = scan_for_enemies()

    -- Step 4: Adjust posture based on enemy presence
    if #enemies_detected > 0 then
        print(NPC.name .. " is prepared to engage in combat with detected enemies.")
    else
        print(NPC.name .. " is on high alert but sees no immediate threats.")
    end
end

-- Example usage:
-- Execute the prepare for combat action
prepare_for_combat_action()
