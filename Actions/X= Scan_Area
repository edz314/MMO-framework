-- Define the NPC object
NPC = {
    name = "Scout",  -- NPC's name
    position = {x = 5, y = 5},  -- Current position
    scan_range = 10,  -- Range within which the NPC can scan the area
    perception = 7,  -- NPC's perception level, affects detection accuracy
}

-- Define objects of interest in the environment
objects_in_area = {
    {name = "Enemy Soldier", position = {x = 8, y = 5}, type = "enemy"},
    {name = "Treasure Chest", position = {x = 12, y = 8}, type = "item"},
    {name = "Hidden Trap", position = {x = 4, y = 7}, type = "trap"},
}

-- Function to calculate the distance between two points
function calculate_distance(point1, point2)
    local dx = point2.x - point1.x
    local dy = point2.y - point1.y
    return math.sqrt(dx * dx + dy * dy)
end

-- Function to scan the area for objects of interest
function scan_area_action()
    print(NPC.name .. " is scanning the area for potential threats and points of interest.")

    local detected_objects = {}

    -- Loop through each object in the area to see if it's within the scan range
    for _, obj in ipairs(objects_in_area) do
        local distance_to_object = calculate_distance(NPC.position, obj.position)

        if distance_to_object <= NPC.scan_range then
            -- Simulate detection accuracy based on perception
            local detection_roll = math.random(1, 10)
            if detection_roll <= NPC.perception then
                table.insert(detected_objects, obj)
                print(NPC.name .. " detects a " .. obj.type .. ": " .. obj.name .. " at position (" .. obj.position.x .. ", " .. obj.position.y .. ").")
            else
                print(NPC.name .. " senses something, but can't pinpoint the exact location.")
            end
        end
    end

    -- If no objects were detected
    if #detected_objects == 0 then
        print(NPC.name .. " found nothing of interest within the scan range.")
    end

    return detected_objects
end

-- Example usage:
-- Execute the scan area action
detected_objects = scan_area_action()

-- Output the list of detected objects
if #detected_objects > 0 then
    print("Objects detected by " .. NPC.name .. ":")
    for _, obj in ipairs(detected_objects) do
        print("- " .. obj.name .. " (" .. obj.type .. ") at position (" .. obj.position.x .. ", " .. obj.position.y .. ")")
    end
else
    print("No objects detected by " .. NPC.name .. ".")
end
