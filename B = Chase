-- Define the NPC object
NPC = {
    speed = 2,  -- Units per second
    position = {x = 0, y = 0},
    target = nil,
}

-- Function to calculate the distance between NPC and target
function calculate_distance(target_position)
    local dx = target_position.x - NPC.position.x
    local dy = target_position.y - NPC.position.y
    return math.sqrt(dx * dx + dy * dy)
end

-- Function to move NPC towards the target
function move_towards_target(target_position, speed)
    -- Calculate the direction vector towards the target
    local direction = {
        x = target_position.x - NPC.position.x,
        y = target_position.y - NPC.position.y
    }

    -- Normalize the direction vector
    local magnitude = calculate_distance(target_position)
    direction.x = direction.x / magnitude
    direction.y = direction.y / magnitude

    -- Move the NPC in the direction of the target
    NPC.position.x = NPC.position.x + direction.x * speed
    NPC.position.y = NPC.position.y + direction.y * speed
end

-- Chase action function
function chase_action()
    -- Check if the NPC has a valid target
    if NPC.target == nil then
        print("No target selected.")
        return
    end

    -- Calculate the distance to the target
    local distance_to_target = calculate_distance(NPC.target.position)

    -- If the target is within a certain distance, move towards the target
    if distance_to_target > 0 then
        -- Move towards the target
        move_towards_target(NPC.target.position, NPC.speed)
        print("Chasing target. Current position: (" .. NPC.position.x .. ", " .. NPC.position.y .. ")")
    else
        -- If already at the target's position, print a message
        print("Target reached.")
    end
end

-- Example usage:
-- Define a target with position
target_enemy = {
    position = {x = 10, y = 10},
}

-- Assign the target to the NPC
NPC.target = target_enemy

-- Execute the chase action
chase_action()

-- Output the NPC's position after chasing
print("NPC's position after chase: (" .. NPC.position.x .. ", " .. NPC.position.y .. ")")
